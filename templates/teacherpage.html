$def with (TeacherInst, Render)

$ S = sessionmaker(bind=DB)()

$ ThisOfferings = S.query(Offering).filter(Offering.teacher == TeacherInst).join(Offering.semester).order_by(desc((Semester.year)*2 + Semester.sem))

$ ThisComments = S.query(TeacherComment).filter(TeacherComment.teacher == TeacherInst).join(TeacherComment.offering).order_by(Offering.subject_id,TeacherComment.offering_id)

$ quest1 = []
$ quest2 = []
$ quest3 = []
$ quest4 = []
$ quest5 = []
$ quest6 = []
$for Line in ThisOfferings:
  $ SearchRate = S.query(OfferingRate).filter(OfferingRate.offering_id == Line.id)
  $for Rate in SearchRate:
    $ quest1.append(Rate.question1)
    $ quest2.append(Rate.question2)
    $ quest3.append(Rate.question3)
    $ quest4.append(Rate.question4)
    $ quest5.append(Rate.question5)
    $ quest6.append(Rate.question6)
$ yData = [quest1 ,quest2 ,quest3 ,quest4 ,quest5 , quest6]

$ display_line = S.query(TeacherDisplay).filter(TeacherDisplay.teacher_id == TeacherInst.id).one()
$ sum_line = S.query(AnswerSumTeacher).filter(AnswerSumTeacher.teacher_id == TeacherInst.id).one()


$ s6 = (sum_line.q6_dificil)+(sum_line.q6_normal)+(sum_line.q6_facil)
$if s6:
  $ q6 = ' %s %s%%' % (display_line.q6_resp, display_line.q6_porc)
$else:
  $ q6 = ""

$ s7 = (sum_line.q7_sim)+(sum_line.q7_nao)
$if s7:
  $ q7 = ' %s %d%%' % (display_line.q7_resp, display_line.q7_porc)
$else:
  $ q7 = ""

$ s8 = (sum_line.q8_boa)+(sum_line.q8_media)+(sum_line.q8_ruim)
$if s8:
  $ q8 = ' %s %d%%' % (display_line.q8_resp, display_line.q8_porc)
$else:
  $ q8 = ""

$ s9 = (sum_line.q9_sim)+(sum_line.q9_nao)
$if s9:
  $ q9 = ' %s %d%%' % (display_line.q9_resp, display_line.q9_porc)
$else:
  $ q9 = ""

$ s10 = (sum_line.q10_sim)+(sum_line.q10_nao)
$if s10:
  $ q10 = ' %s %d%%' % (display_line.q10_resp, display_line.q10_porc)
$else:
  $ q10 = ""

$ s11 = (sum_line.q11_sim)+(sum_line.q11_nao)
$if s11:
  $ q11 = ' %s %d%%' % (display_line.q11_resp, display_line.q11_porc)
$else:
  $ q11 = ""

$ s12 = (sum_line.q12_sim)+(sum_line.q12_nao)
$if s12:
  $ q12 = ' %s %d%%' % (display_line.q12_resp, display_line.q12_porc)
$else:
  $ q12 = ""

$ s13 = (sum_line.q13_sim)+(sum_line.q13_nao)
$if s13:
  $ q13 = ' %s %d%%' % (display_line.q13_resp, display_line.q13_porc)
$else:
  $ q13 = ""

<!DOCTYPE html>
<html>
  <head>
    $:Render.includes()
    <title>$BaseTitle - $TeacherInst.name</title>
  </head>
  <body>
    <!-- Fixed navbar -->
    $:Render.navbar(Render.user_id)
    <!-- Begin page content -->
    <div class="container">
      <h3>$TeacherInst.name </h3>
      <div id="gda-row" class="row">

        <div id="comments" class="panel panel-default col-sm-6">
          <div class="panel-heading">Comentários</div>
          <div class="panel-body text-justify">
            $:Render.commentsteacher(ThisComments)
          </div>
        </div>

        <div id="gda" class="panel panel-default col-sm-6">
            <table class="table">
              <tbody>
                <tr class="bottom-column">
                  $:Render.questionyesno(sum_line.q7_sim,sum_line.q7_nao, "A bibliografia recomendada foi adequada?")
                  $:Render.questionyesno(sum_line.q9_sim,sum_line.q9_nao, "O professor se preocupou em tornar as aulas interessantes?")
                </tr>
                <tr>
                  $:Render.questionyesno(sum_line.q10_sim,sum_line.q10_nao, " O professor se mostrou acessível para tirar dúvidas?")
                  $:Render.questionyesno(sum_line.q11_sim,sum_line.q11_nao, "As avaliações foram coerentes?")
                </tr>
                <tr>
                  $:Render.questionyesno(sum_line.q12_sim,sum_line.q12_nao, "Ir às aulas foi importante?")
                  $:Render.questionlowmedhigh(sum_line.q6_dificil,sum_line.q6_normal,sum_line.q6_facil,"Como você avalia a dificuldade inerente ao professor?", "fa fa-bomb")
                </tr>
                <tr>
                  $:Render.questionlowmedhigh(sum_line.q8_boa,sum_line.q8_media,sum_line.q8_ruim, "Como você avalia a didática do professor?", "fa fa-star")
                  $:Render.questionyesno(sum_line.q13_sim,sum_line.q13_nao, "Faria outra disciplina com o professor?")
                </tr>
              </tbody>
            </table>
        </div>
      </div>
      <div id="offering-row" class="row">
        <div id="oferecimentos" class="col-sm-6">
          <div class="row">
              <input type="text" class="search" placeholder="Busca por disciplina">
              <table class="table table-striped table-condensed sortable table-hover">
                <thead>
                  <tr>
                    <th>Semestre</th>
                    <th><i class="fa fa-users" aria-hidden="true" data-toggle="tooltip" title="Matriculados"></i></th>
                    <th>Turma</th>
                    <th>Disciplina</th>
                    <th> A </th>
                    <th> B </th>
                    <th> C </th>
                    <th> D </th>
                    <th> E </th>
                    <th> F </th>
                  </tr>
                </thead>
                <tbody class="list">
                $for Line in ThisOfferings:
                  $ URL = Line.EncodeURL()
                  $ Code = '%s' % (Line.code)
                  $ Enrolled = '%s' % (Line.students)
                  $ Sem = '%ss%s' % (Line.semester.sem, Line.semester.year)
                  $ SearchRate = S.query(OfferingRate).filter(OfferingRate.offering_id == Line.id)
                  $ Rated = 0
                  $for Lin in SearchRate:
                    $ Rate = Lin
                    $ Rated = 1
                  <tr class="clickable-row" data-url='$URL' data-toggle="tooltip" title="$Line.subject.name">
                    <td><a class="semestre black-link" href="$URL">$Sem</a></td>
                    <td>$Enrolled</td>
                    <td>$Code</td>
                    <td><a class="codigo black-link" href="$Line.subject.EncodeURL()" >$Line.subject.code</a></td>
                    $if Rated:
                      <td id="q1">$Rate.question1</td>
                      <td id="q2">$Rate.question2</td>
                      <td id="q3">$Rate.question3</td>
                      <td id="q4">$Rate.question4</td>
                      <td id="q5">$Rate.question5</td>
                      <td id="q6">$Rate.question6</td>
                    $else:
                      $for i in range(0,6):
                        <td> <i class="fa fa-minus"></i> </td>
                  </tr>
                </tbody>
              </table>
              <script>
                var options = {
                  valueNames: ['codigo']
                };
                var userList = new List('oferecimentos', options);
              </script>
          </div>
        </div>

        <div class="col-sm-4">
            <h4 class="text-center" id="graph_title"> <span>Selecione um oferecimento</span> </h4>
            <div id="graph"></div>
        </div>
        <div class="col-sm-2">
            $:Render.legendboxplot()
        </div>
      </div>
    </div>
    $:Render.footer()
  </body>
</html>
<script>
  //function boxplot(yData, title_default,title_custom)
  yData = $(yData);
  title_default = "Selecione um oferecimento";
  title_custom = [".codigo", ".semestre"];
  boxplot(yData, 0 ,"#graph" ,title_default,title_custom);
</script>
